
CREATE TABLE IF NOT EXISTS FLARE_PROFILE (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROFILE_KEY VARCHAR(24) UNIQUE,
    SERVER_BRAND VARCHAR(255) NOT NULL,
    SERVER_VERSION VARCHAR(255) NOT NULL,
    OS_FAMILY VARCHAR(255) NOT NULL,
    OS_VERSION VARCHAR(255) NOT NULL,
    JVM_VENDOR VARCHAR(255) NOT NULL,
    JVM_VERSION VARCHAR(255) NOT NULL,
    RAW BYTEA NOT NULL,
    CREATED_AT TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS FLARE_SAMPLE_DATA (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROFILE_KEY VARCHAR(24) NOT NULL,
    RAW BYTEA NOT NULL,
    CONSTRAINT FK_SAMPLE_DATA_PROFILE
        FOREIGN KEY (PROFILE_KEY)
        REFERENCES FLARE_PROFILE(PROFILE_KEY)
        ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS IDX_SAMPLE_DATA_PROFILE_KEY ON FLARE_SAMPLE_DATA(PROFILE_KEY);

CREATE TABLE IF NOT EXISTS FLARE_SAMPLE_TIMELINE (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROFILE_KEY VARCHAR(24) NOT NULL,
    RAW BYTEA NOT NULL,
    CONSTRAINT FK_SAMPLE_TIMELINE_PROFILE
        FOREIGN KEY (PROFILE_KEY)
        REFERENCES FLARE_PROFILE(PROFILE_KEY)
        ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS IDX_SAMPLE_TIMELINE_PROFILE_KEY ON FLARE_SAMPLE_TIMELINE(PROFILE_KEY);
